package org.datasource.oracle;

import org.springframework.stereotype.Service;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

@Service
public class OracleViewBuilder {
	// SQL Map
	private String SQL_POSITION_SELECT =
			"SELECT * FROM MYUSER.POSITION";

	// DataCache
	private List<OraclePositionView> positionViewList = new ArrayList<>();

	public List<OraclePositionView> getPositionViewList() {
		return this.positionViewList;
	}
	
	public List<OraclePositionView> getViewList() {
		return this.positionViewList;
	}
	
	// building steps
	public OracleViewBuilder build(String nameOfTable) {
		try (Connection jdbcConnection = jdbcConnector.getConnection()) {
			Statement selectStmt = jdbcConnection.createStatement();
			
			switch(nameOfTable) {
				case "Position":
					ResultSet rs = selectStmt.executeQuery(SQL_POSITION_SELECT);
	
					positionViewList = new ArrayList<>();
					while (rs.next()) {
						Integer positionId = rs.getInt("PositionId");
						String positionName = rs.getString("PositionName");
						this.positionViewList.add(new OraclePositionView(positionName, positionId));
					}
				break;
				
				case "Level":
					rs = selectStmt.executeQuery(SQL_POSITION_SELECT);
	
					positionViewList = new ArrayList<>();
					while (rs.next()) {
						Integer positionId = rs.getInt("PositionId");
						String positionName = rs.getString("PositionName");
						this.positionViewList.add(new OraclePositionView(positionName, positionId));
					}
				break;
				
				case "WayOfWorking":
					rs = selectStmt.executeQuery(SQL_POSITION_SELECT);
	
					positionViewList = new ArrayList<>();
					while (rs.next()) {
						Integer positionId = rs.getInt("PositionId");
						String positionName = rs.getString("PositionName");
						this.positionViewList.add(new OraclePositionView(positionName, positionId));
					}
				break;
				
				case "Salary":
					rs = selectStmt.executeQuery(SQL_POSITION_SELECT);
	
					positionViewList = new ArrayList<>();
					while (rs.next()) {
						Integer positionId = rs.getInt("PositionId");
						String positionName = rs.getString("PositionName");
						this.positionViewList.add(new OraclePositionView(positionName, positionId));
					}
				break;
			}			
		} catch (Exception ex) {
			ex.printStackTrace();
		}

		return this;
	}

	/* JDBC Session Management ---------------------------------------- */
	private OracleDataSourceConnector jdbcConnector;
	public OracleViewBuilder() {
		
		this.jdbcConnector = new OracleDataSourceConnector();
		
	}
}
